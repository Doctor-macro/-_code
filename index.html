<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>VBA Code Share</title>
<style>
  body { font-family: Consolas, monospace; padding: 20px; }
  pre {
    background: #f5f5f5;
    padding: 15px;
    border-radius: 6px;
    overflow-x: auto;
  }
</style>
</head>
<body>
<h2>VBA Code</h2>
<pre><code>

=LET(
  base,INT($B$2),
  prev,INT(EDATE(base,-1)),
  ID,Sheet1!$J$4:$J$20000,
  Mon,INT(Sheet1!$C$4:$C$20000),
  idsBase, UNIQUE(FILTER(ID, Mon=base)),
  idsPrev, UNIQUE(FILTER(ID, Mon=prev)),
  common, FILTER(idsBase, ISNUMBER(MATCH(idsBase, idsPrev, 0))),
  SUM(--MAP(common, LAMBDA(e, 月別最高位ランク(e,prev)<>月別最高位ランク(e,base))))
)

                          
</code></pre>
</body>
</html>
